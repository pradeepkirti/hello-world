Closed Payment Research Cases Report [CFIW0038]

SELECT
  DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS,
  max( rtrim(SPSR_DIM_PAM.LGCY_SPSR_ID)  ),
  max( SPSR_DIM_PAM.BSNS_NM  ),
  'CONFIDENTIAL',
  'Fiserv',
  SUM(BUS_DAY_CAL.CKFR_BSNS_DAY_IND),
  'Custom SQL'
FROM
  DW.VW_DATE_DIM  BUS_DAY_CAL INNER JOIN DW.VW_CLM_LIFECYC_SMRY ON (date(BUS_DAY_CAL.DATE_DIM_ID)>=date(DW.VW_CLM_LIFECYC_SMRY.CLM_OPEN_TMS)  AND  date(BUS_DAY_CAL.DATE_DIM_ID)<=date(DW.VW_CLM_LIFECYC_SMRY.INIT_RSLTN_TMS))
   RIGHT OUTER JOIN ADMIN.VW_CC_CASE ON (DW.VW_CLM_LIFECYC_SMRY.CASE_ID=ADMIN.VW_CC_CASE.CASE_ID)
   INNER JOIN SPM.VW_SPSR_DIM  SPSR_DIM_PAM ON (ADMIN.VW_CC_CASE.SPSR_ORG_INDV_ID=SPSR_DIM_PAM.SPSR_ORG_ID)
   INNER JOIN DW.VW_ORG_RPT ON (SPSR_DIM_PAM.SPSR_ORG_ID=DW.VW_ORG_RPT.ORG_INDV_ID)
   INNER JOIN DW.VW_RPT ON (DW.VW_ORG_RPT.RPT_ID=DW.VW_RPT.RPT_ID)
WHERE
  (
   ( @Prompt(strClientID) = '-1'
OR
( rtrim(SPSR_DIM_PAM.LGCY_SPSR_ID) ) = @Prompt(strClientID)  )
   AND
   (
    DW.VW_CLM_LIFECYC_SMRY.CLM_REOPN_SEQ_NBR  =  0
    AND
    ( ( DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS )
BETWEEN CASE WHEN @Prompt(dtRunDate) = '9999-12-31 00:00:00' THEN DATE_TRUNC('Month',CURRENT_DATE)  ELSE  DATE_TRUNC('Month',@Prompt(dtRunDate)) END AND CASE WHEN @Prompt(dtRunDate) = '9999-12-31 00:00:00' THEN current_date ELSE  @Prompt(dtRunDate) END  )
   )
   AND
   DW.VW_RPT.LGCY_RPT_ID  =  @Prompt('Enter a Report ID','N',,Mono,Free,Not_Persistent,,User:-1)
   and date(BUS_DAY_CAL.DATE_DIM_ID) BETWEEN CASE WHEN @Prompt(dtRunDate) = '9999-12-31 00:00:00' THEN DATE_TRUNC('Month',CURRENT_DATE)  ELSE  DATE_TRUNC('Month',@Prompt(dtRunDate)) END AND CASE WHEN @Prompt(dtRunDate) = '9999-12-31 00:00:00' THEN current_date ELSE  @Prompt(dtRunDate) END
  )
GROUP BY
  DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS, 
  SPSR_DIM_PAM.SPSR_ORG_ID, 
  'CONFIDENTIAL', 
  'Fiserv', 
  'Custom SQL'





SELECT
  DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS AS CLM_END_TMS,
  MAX(RTRIM(SPSR_DIM_PAM.LGCY_SPSR_ID)) AS LGCY_SPSR_ID,
  MAX(SPSR_DIM_PAM.BSNS_NM) AS BSNS_NM,
  'CONFIDENTIAL' AS Confidential,
  'Fiserv' AS Fiserv,
  SUM(CAST(BUS_DAY_CAL.CKFR_BSNS_DAY_IND AS INTEGER)) AS CKFR_BSNS_DAY_IND,
  'Custom SQL' AS Custom_SQL
FROM
  DW.VW_DATE_DIM BUS_DAY_CAL
  INNER JOIN DW.VW_CLM_LIFECYC_SMRY ON DATE(BUS_DAY_CAL.DATE_DIM_ID) BETWEEN DATE(DW.VW_CLM_LIFECYC_SMRY.CLM_OPEN_TMS) AND DATE(DW.VW_CLM_LIFECYC_SMRY.INIT_RSLTN_TMS)
  RIGHT OUTER JOIN ADMIN.VW_CC_CASE ON DW.VW_CLM_LIFECYC_SMRY.CASE_ID = ADMIN.VW_CC_CASE.CASE_ID
  INNER JOIN SPM.VW_SPSR_DIM SPSR_DIM_PAM ON ADMIN.VW_CC_CASE.SPSR_ORG_INDV_ID = SPSR_DIM_PAM.SPSR_ORG_ID
  INNER JOIN DW.VW_ORG_RPT ON SPSR_DIM_PAM.SPSR_ORG_ID = DW.VW_ORG_RPT.ORG_INDV_ID
  INNER JOIN DW.VW_RPT ON DW.VW_ORG_RPT.RPT_ID = DW.VW_RPT.RPT_ID
WHERE
  (
    (@Prompt('strClientID') = '-1' OR RTRIM(SPSR_DIM_PAM.LGCY_SPSR_ID) = @Prompt('strClientID'))
    AND DW.VW_CLM_LIFECYC_SMRY.CLM_REOPN_SEQ_NBR = 0
    AND DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS BETWEEN
      CASE WHEN @Prompt('dtRunDate') = '9999-12-31 00:00:00' THEN DATE_TRUNC('month', CURRENT_DATE)
           ELSE DATE_TRUNC('month', @Prompt('dtRunDate')) END
      AND
      CASE WHEN @Prompt('dtRunDate') = '9999-12-31 00:00:00' THEN CURRENT_DATE
           ELSE @Prompt('dtRunDate') END
    AND DW.VW_RPT.LGCY_RPT_ID = @Prompt('Enter a Report ID', 'N', 'Mono', 'Free', 'Not_Persistent', 'User:-1')
    AND DATE(BUS_DAY_CAL.DATE_DIM_ID) BETWEEN
      CASE WHEN @Prompt('dtRunDate') = '9999-12-31 00:00:00' THEN DATE_TRUNC('month', CURRENT_DATE)
           ELSE DATE_TRUNC('month', @Prompt('dtRunDate')) END
      AND
      CASE WHEN @Prompt('dtRunDate') = '9999-12-31 00:00:00' THEN CURRENT_DATE
           ELSE @Prompt('dtRunDate') END
  )
GROUP BY
  DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS,
  SPSR_DIM_PAM.SPSR_ORG_ID,
  'CONFIDENTIAL',
  'Fiserv',
  'Custom SQL';





SELECT
  DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS AS CLM_END_TMS,
  MAX(RTRIM(SPSR_DIM_PAM.LGCY_SPSR_ID)) AS LGCY_SPSR_ID,
  MAX(SPSR_DIM_PAM.BSNS_NM) AS BSNS_NM,
  'CONFIDENTIAL' AS Confidential,
  'Fiserv' AS Fiserv,
  SUM(CAST(BUS_DAY_CAL.CKFR_BSNS_DAY_IND AS INTEGER)) AS CKFR_BSNS_DAY_IND,
  'Custom SQL' AS Custom_SQL
FROM
  DW.VW_DATE_DIM BUS_DAY_CAL
  INNER JOIN DW.VW_CLM_LIFECYC_SMRY ON DATE(BUS_DAY_CAL.DATE_DIM_ID) BETWEEN DATE(DW.VW_CLM_LIFECYC_SMRY.CLM_OPEN_TMS) AND DATE(DW.VW_CLM_LIFECYC_SMRY.INIT_RSLTN_TMS)
  RIGHT OUTER JOIN ADMIN.VW_CC_CASE ON DW.VW_CLM_LIFECYC_SMRY.CASE_ID = ADMIN.VW_CC_CASE.CASE_ID
  INNER JOIN SPM.VW_SPSR_DIM SPSR_DIM_PAM ON ADMIN.VW_CC_CASE.SPSR_ORG_INDV_ID = SPSR_DIM_PAM.SPSR_ORG_ID
  INNER JOIN DW.VW_ORG_RPT ON SPSR_DIM_PAM.SPSR_ORG_ID = DW.VW_ORG_RPT.ORG_INDV_ID
  INNER JOIN DW.VW_RPT ON DW.VW_ORG_RPT.RPT_ID = DW.VW_RPT.RPT_ID
WHERE
  (
    (CASE WHEN ?strClientID? = '-1' THEN 1 ELSE RTRIM(SPSR_DIM_PAM.LGCY_SPSR_ID) END = ?strClientID?)
    AND DW.VW_CLM_LIFECYC_SMRY.CLM_REOPN_SEQ_NBR = 0
    AND DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS BETWEEN
      CASE WHEN ?dtRunDate? = '9999-12-31 00:00:00' THEN DATE_TRUNC('MONTH', CURRENT_DATE)
           ELSE DATE_TRUNC('MONTH', TO_DATE(?dtRunDate?, 'YYYY-MM-DD HH24:MI:SS')) END
      AND
      CASE WHEN ?dtRunDate? = '9999-12-31 00:00:00' THEN CURRENT_DATE
           ELSE TO_DATE(?dtRunDate?, 'YYYY-MM-DD HH24:MI:SS') END
    AND DW.VW_RPT.LGCY_RPT_ID = TO_NUMBER(?ReportID?)
    AND DATE(BUS_DAY_CAL.DATE_DIM_ID) BETWEEN
      CASE WHEN ?dtRunDate? = '9999-12-31 00:00:00' THEN DATE_TRUNC('MONTH', CURRENT_DATE)
           ELSE DATE_TRUNC('MONTH', TO_DATE(?dtRunDate?, 'YYYY-MM-DD HH24:MI:SS')) END
      AND
      CASE WHEN ?dtRunDate? = '9999-12-31 00:00:00' THEN CURRENT_DATE
           ELSE TO_DATE(?dtRunDate?, 'YYYY-MM-DD HH24:MI:SS') END
  )
GROUP BY
  DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS,
  SPSR_DIM_PAM.SPSR_ORG_ID,
  'CONFIDENTIAL',
  'Fiserv',
  'Custom SQL';

