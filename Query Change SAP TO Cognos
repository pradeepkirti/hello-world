Closed Payment Research Cases Report [CFIW0038]

SELECT
  DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS,
  max( rtrim(SPSR_DIM_PAM.LGCY_SPSR_ID)  ),
  max( SPSR_DIM_PAM.BSNS_NM  ),
  'CONFIDENTIAL',
  'Fiserv',
  SUM(BUS_DAY_CAL.CKFR_BSNS_DAY_IND),
  'Custom SQL'
FROM
  DW.VW_DATE_DIM  BUS_DAY_CAL INNER JOIN DW.VW_CLM_LIFECYC_SMRY ON (date(BUS_DAY_CAL.DATE_DIM_ID)>=date(DW.VW_CLM_LIFECYC_SMRY.CLM_OPEN_TMS)  AND  date(BUS_DAY_CAL.DATE_DIM_ID)<=date(DW.VW_CLM_LIFECYC_SMRY.INIT_RSLTN_TMS))
   RIGHT OUTER JOIN ADMIN.VW_CC_CASE ON (DW.VW_CLM_LIFECYC_SMRY.CASE_ID=ADMIN.VW_CC_CASE.CASE_ID)
   INNER JOIN SPM.VW_SPSR_DIM  SPSR_DIM_PAM ON (ADMIN.VW_CC_CASE.SPSR_ORG_INDV_ID=SPSR_DIM_PAM.SPSR_ORG_ID)
   INNER JOIN DW.VW_ORG_RPT ON (SPSR_DIM_PAM.SPSR_ORG_ID=DW.VW_ORG_RPT.ORG_INDV_ID)
   INNER JOIN DW.VW_RPT ON (DW.VW_ORG_RPT.RPT_ID=DW.VW_RPT.RPT_ID)
WHERE
  (
   ( @Prompt(strClientID) = '-1'
OR
( rtrim(SPSR_DIM_PAM.LGCY_SPSR_ID) ) = @Prompt(strClientID)  )
   AND
   (
    DW.VW_CLM_LIFECYC_SMRY.CLM_REOPN_SEQ_NBR  =  0
    AND
    ( ( DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS )
BETWEEN CASE WHEN @Prompt(dtRunDate) = '9999-12-31 00:00:00' THEN DATE_TRUNC('Month',CURRENT_DATE)  ELSE  DATE_TRUNC('Month',@Prompt(dtRunDate)) END AND CASE WHEN @Prompt(dtRunDate) = '9999-12-31 00:00:00' THEN current_date ELSE  @Prompt(dtRunDate) END  )
   )
   AND
   DW.VW_RPT.LGCY_RPT_ID  =  @Prompt('Enter a Report ID','N',,Mono,Free,Not_Persistent,,User:-1)
   and date(BUS_DAY_CAL.DATE_DIM_ID) BETWEEN CASE WHEN @Prompt(dtRunDate) = '9999-12-31 00:00:00' THEN DATE_TRUNC('Month',CURRENT_DATE)  ELSE  DATE_TRUNC('Month',@Prompt(dtRunDate)) END AND CASE WHEN @Prompt(dtRunDate) = '9999-12-31 00:00:00' THEN current_date ELSE  @Prompt(dtRunDate) END
  )
GROUP BY
  DW.VW_CLM_LIFECYC_SMRY.CLM_END_TMS, 
  SPSR_DIM_PAM.SPSR_ORG_ID, 
  'CONFIDENTIAL', 
  'Fiserv', 
  'Custom SQL'
