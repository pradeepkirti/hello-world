total (
    case 
        when ([Transfer Direction] = 'Inbound' and cast(extract(month, [Month Year TN]) as varchar(2)) || '-' || cast(extract(year, [Month Year TN]) as varchar(4)) = [Udf_This Month]) 
        then [TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA] 
        else 0 
    end
)




ReportFilter-Home


=Replace(ReportFilter([Home Name - ID]);";";", "+Char(13)+Char(10))

ReportFilter-DormantPeriod

=UserResponse("Select Dormant Period:") + " days, as of " + FormatDate(RelativeDate(CurrentDate();-1); "Mmmm d, yyyy")

Has Transacted

=If IsNull([Last Send Date]) And IsNull([Last Received Money Date]) And IsNull([Last Request-to-Pay Sent Date])
Then "No"
Else "Yes"

ReportFilter-HasTransacted

=Replace(ReportFilter([Has Transacted]);";";", "+Char(13)+Char(10))

Has Sent Money (Non KTP)

=If IsNull([Last Send Money Date (Non-KTP)])
Then "No"
Else "Yes"


=[ReportFilter-HasSentMoneyNonKTP]


=Replace(ReportFilter([Has Sent Money (Non KTP)]);";";", "+Char(13)+Char(10))

Has Sent Money (KTP)

=If IsNull([Last KTP Send Money Date])
Then "No"
Else "Yes"


=[ReportFilter-HasSentMoneyKTP]

=Replace(ReportFilter([Has Sent Money (KTP)]);";";", "+Char(13)+Char(10))



=If IsNull([Last Send Money Date (Non-KTP)]) Then [Last KTP Send Money Date]
   ElseIf IsNull([Last KTP Send Money Date]) Then [Last Send Money Date (Non-KTP)]
   ElseIf [Last KTP Send Money Date] < [Last Send Money Date (Non-KTP)] Then [Last Send Money Date (Non-KTP)]
   Else [Last KTP Send Money Date]


CASE 
  WHEN [Last Send Money Date (Non-KTP)] IS NULL THEN [Last KTP Send Money Date]
  WHEN [Last KTP Send Money Date] IS NULL THEN [Last Send Money Date (Non-KTP)]
  WHEN [Last KTP Send Money Date] < [Last Send Money Date (Non-KTP)] THEN [Last Send Money Date (Non-KTP)]
  ELSE [Last KTP Send Money Date]
END


=LeftTrim(RightTrim(Replace(Replace(If Pos(ReportFilterSummary("Dormant P2P Users"); "Days since last transaction is more than") > 0 
Then Substr(ReportFilterSummary("Dormant P2P Users"); Pos(ReportFilterSummary("Dormant P2P Users"); "Days since last transaction is more than"); Pos(Substr(ReportFilterSummary("Dormant P2P Users"); Pos(ReportFilterSummary("Dormant P2P Users"); "Days since last transaction is more than"); 200); Char(13)) - 1); "Days since last transaction is more than ";"");"Greater than";"")))
CASE 
  WHEN POSITION('Days since last transaction is more than' IN ReportFilterSummary('Dormant P2P Users')) > 0 THEN 
    TRIM(
      REPLACE(
        REPLACE(
          SUBSTRING(
            ReportFilterSummary('Dormant P2P Users'),
            POSITION('Days since last transaction is more than' IN ReportFilterSummary('Dormant P2P Users')),
            POSITION(CHAR(13) IN SUBSTRING(ReportFilterSummary('Dormant P2P Users'), POSITION('Days since last transaction is more than' IN ReportFilterSummary('Dormant P2P Users')))) - 1
          ),
          'Days since last transaction is more than ', 
          ''
        ),
        'Greater than', 
        ''
      )
    )
  ELSE 
    NULL
END

=UserResponse("Select Dormant Period:") + " days, as of " + FormatDate(RelativeDate(CurrentDate();-1); "Mmmm d, yyyy")

ParamDisplayValue('Select Dormant Period:') + ' days, as of ' + to_char(current_date - 1 day, 'MMMM D, YYYY')

=Replace(ReportFilter([Has Received Money]);";";", "+Char(13)+Char(10))
=Replace(ReportFilter([Has Requested Money]);";";", "+Char(13)+Char(10))
=Replace(ReportFilter([Has Sent Money (KTP)]);";";", "+Char(13)+Char(10))
=Replace(ReportFilter([Has Sent Money (Non KTP)]);";";", "+Char(13)+Char(10))
=Replace(ReportFilter([Has Transacted]);";";", "+Char(13)+Char(10))
=Replace(ReportFilter([Home Name - ID]);";";", "+Char(13)+Char(10))

replace(ReportFilter('Has Received Money'), ';', ', ' || chr(13) || chr(10))
replace(ReportFilter('Has Received Money'), ';', ', ' + chr(13) + chr(10))


=LeftTrim(RightTrim(Replace(Replace(If Pos(ReportFilterSummary("Dormant P2P Users"); "Days since last transaction is more than") > 0 
Then Substr(ReportFilterSummary("Dormant P2P Users"); Pos(ReportFilterSummary("Dormant P2P Users"); "Days since last transaction is more than"); Pos(Substr(ReportFilterSummary("Dormant P2P Users"); Pos(ReportFilterSummary("Dormant P2P Users"); "Days since last transaction is more than"); 200); Char(13)) - 1); "Days since last transaction is more than ";"");"Greater than";"")))



case
  when position('Days since last transaction is more than', ReportFilterSummary('Dormant P2P Users')) > 0 then
    ltrim(rtrim(
      replace(
        replace(
          substring(
            ReportFilterSummary('Dormant P2P Users'),
            position('Days since last transaction is more than', ReportFilterSummary('Dormant P2P Users')),
            locate(char(13), substring(ReportFilterSummary('Dormant P2P Users'), position('Days since last transaction is more than', ReportFilterSummary('Dormant P2P Users')))) - 1
          ),
          'Days since last transaction is more than ', ''
        ),
        'Greater than', ''
      )
    ))
end
=If ([Udf_Large Clients TMLY] = 0) Then 0 Else (([Udf_Large Clients TM] - [Udf_Large Clients TMLY])/[Udf_Large Clients TMLY])
CASE 
  WHEN [Udf_Large Clients TMLY] = 0 THEN 0
  ELSE ([Udf_Large Clients TM] - [Udf_Large Clients TMLY]) / [Udf_Large Clients TMLY]
END



=If (IsNull(([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where ((FormatDate([Month Year TN];"Mmm-yy") = [Udf_This Month Last Year]) And ([Mobile TransferNow Activity] = "MOBILE"))) = 1) Then 0 

Else ((([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where ((FormatDate([Month Year TN];"Mmm-yy") = [Udf_This Month Last Year]) And ([Mobile TransferNow Activity] = "MOBILE")))

/(Sum(([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where (FormatDate([Month Year TN];"Mmm-yy") = [Udf_This Month Last Year]))) In ([Home ID]))



=If (IsNull(([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where ((FormatDate([Month Year TN];"Mmm-yy") = [Udf_This Month Last Year]) And ([Mobile TransferNow Activity] = "MOBILE"))) = 1) Then 0 

Else ((([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where ((FormatDate([Month Year TN];"Mmm-yy") = [Udf_This Month Last Year]) And ([Mobile TransferNow Activity] = "MOBILE")))

/(Sum(([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where (FormatDate([Month Year TN];"Mmm-yy") = [Udf_This Month Last Year]))) In ([Home ID]))



=If (IsNull(([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where (([Date TN] Between([Udf_Last 12 Months Start Date];[Udf_Last 12 Months End Date])) And ([Mobile TransferNow Activity] = "MOBILE"))) = 1) Then 0 
Else ((([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where (([Date TN] Between([Udf_Last 12 Months Start Date];[Udf_Last 12 Months End Date])) And ([Mobile TransferNow Activity] = "MOBILE")))
/(Sum(([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where ([Date TN] Between([Udf_Last 12 Months Start Date];[Udf_Last 12 Months End Date])))) In ([Home ID]))



=If (IsNull(([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where (([Date TN] Between([Udf_Last to Last Year Start Date];[Udf_Last to Last Year End Date])) And ([Mobile TransferNow Activity] = "MOBILE"))) = 1) Then 0 
Else ((([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where (([Date TN] Between([Udf_Last to Last Year Start Date];[Udf_Last to Last Year End Date])) And ([Mobile TransferNow Activity] = "MOBILE")))
/(Sum(([TransferNow Activity].[TN Transfer Count] + [TransferNow Activity - BOFA].[TN Transfer Count - BOFA]) Where ([Date TN] Between([Udf_Last to Last Year Start Date];[Udf_Last to Last Year End Date])))) In ([Home ID]))
